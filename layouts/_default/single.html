{{ define "main" }}

<!-- Hero Section -->
{{ $fallback :=
"https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/Hagia_Sophia_Mars_2013.jpg/1920px-Hagia_Sophia_Mars_2013.jpg"
}}
{{ if eq .Params.type "Cami" }}
{{ $fallback =
"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a4/Sultan_Ahmed_Mosque_Istanbul.jpg/1200px-Sultan_Ahmed_Mosque_Istanbul.jpg"
}}
{{ else if eq .Params.type "M√ºze" }}
{{ $fallback =
"https://upload.wikimedia.org/wikipedia/commons/thumb/c/c6/Istanbul_Archaeology_Museum_Main_Building_2019.jpg/1200px-Istanbul_Archaeology_Museum_Main_Building_2019.jpg"
}}
{{ else if eq .Params.type "Antik Kent" }}
{{ $fallback =
"https://upload.wikimedia.org/wikipedia/commons/thumb/7/7d/Celsus_Library_Ephesus.jpg/1200px-Celsus_Library_Ephesus.jpg"
}}
{{ else if eq .Params.type "Kale" }}
{{ $fallback =
"https://upload.wikimedia.org/wikipedia/commons/thumb/9/91/Rumeli_Hisar%C4%B1_ve_Fatih_Sultan_Mehmet_K%C3%B6pr%C3%BCs%C3%BC.jpg/1200px-Rumeli_Hisar%C4%B1_ve_Fatih_Sultan_Mehmet_K%C3%B6pr%C3%BCs%C3%BC.jpg"
}}
{{ end }}

{{ $bgImage := .Params.image | default .Params.featured_image | default .Params.cover | default $fallback }}
<div class="hero-section"
    style="background-image: url('{{ $bgImage }}'); min-height: 50vh; align-items: flex-end; padding-bottom: 60px; margin-bottom: 0; position: relative;">
    <div class="hero-overlay"
        style="background: linear-gradient(to top, rgba(26, 37, 47, 0.95) 0%, rgba(26, 37, 47, 0.5) 60%, rgba(26, 37, 47, 0.2) 100%);">
    </div>
    <div class="container hero-content"
        style="text-align: left; margin: 0; position: relative; z-index: 2; width: 100%;">
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <a href="/turler/{{ .Params.type | urlize }}" class="badge"
                style="background: var(--accent); color: var(--primary); text-decoration: none; font-weight: 700;">{{
                .Params.type }}</a>
            <a href="/iller/{{ .Params.province | urlize }}" class="badge"
                style="background: rgba(255,255,255,0.2); color: white; backdrop-filter: blur(5px); text-decoration: none;">{{
                .Params.province }}</a>
        </div>
        <h1 class="hero-title"
            style="font-size: clamp(2rem, 5vw, 3.5rem); margin-bottom: 10px; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.5);">
            {{ .Title }}</h1>
        <div class="hero-meta" style="font-size: 1.1rem; color: rgba(255,255,255,0.9);">
            üìç {{ .Params.district }}, {{ .Params.province }}
        </div>
    </div>
</div>

<div class="container" style="margin-top: 40px;">
    <!-- Breadcrumb -->
    <nav style="margin-bottom: 30px; font-size: 0.9rem; color: var(--text-light);">
        <a href="/">Anasayfa</a> <span style="margin: 0 5px;">/</span>
        <a href="/iller/{{ .Params.province | urlize }}">{{ .Params.province }}</a> <span
            style="margin: 0 5px;">/</span>
        <a href="/turler/{{ .Params.type | urlize }}">{{ .Params.type }}</a> <span style="margin: 0 5px;">/</span>
        <span style="color: var(--primary); font-weight: 600;">{{ .Title }}</span>
    </nav>

    <!-- Map Logic -->
    {{ $mapLink := "" }}
    {{ $showMap := false }}
    {{ if .Params.coords }}
    {{ $coords := split .Params.coords "," }}
    {{ if eq (len $coords) 2 }}
    {{ $lat := float (index $coords 1) }}
    {{ $lon := float (index $coords 0) }}

    {{/* Turkey Bounding Box: Lat 35.8 - 42.1, Lon 25.6 - 44.8 */}}
    {{/* Check if valid, otherwise swap */}}
    {{ if or (lt $lat 35.0) (gt $lat 43.0) }}
    {{/* Maybe swapped? Try swapping */}}
    {{ $temp := $lat }}
    {{ $lat = $lon }}
    {{ $lon = $temp }}
    {{ end }}

    {{/* Final Check */}}
    {{ if and (ge $lat 35.0) (le $lat 43.0) (ge $lon 25.0) (le $lon 45.0) }}
    {{ $mapLink = printf "https://www.google.com/maps/search/?api=1&query=%f,%f" $lat $lon }}
    {{ $showMap = true }}
    {{ else }}
    {{/* Fallback to search if still invalid */}}
    {{ $mapLink = printf "https://www.google.com/maps/search/?api=1&query=%s+%s" (.Title | urlquery) (.Params.province |
    urlquery) }}
    {{ $showMap = true }}
    {{ end }}
    {{ else }}
    {{ $mapLink = printf "https://www.google.com/maps/search/?api=1&query=%s+%s" (.Title | urlquery) (.Params.province |
    urlquery) }}
    {{ $showMap = true }}
    {{ end }}
    {{ else }}
    {{ $mapLink = printf "https://www.google.com/maps/search/?api=1&query=%s+%s+%s" (.Title | urlquery)
    (.Params.district | urlquery) (.Params.province | urlquery) }}
    {{ $showMap = true }}
    {{ end }}

    <div class="article-layout">
        <!-- Main Content -->
        <article>
            <!-- Mobile Quick Info (Refactored) -->
            <div class="mobile-quick-info" style="margin-bottom: 30px;">
                {{ partial "visitor-info.html" . }}
            </div>

            <!-- Main Content -->

            {{ if .TableOfContents }}
            <div class="toc" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 30px;">
                <h4 style="margin-bottom: 10px; font-size: 1.1rem;">ƒ∞√ßindekiler</h4>
                {{ .TableOfContents }}
            </div>
            {{ end }}

            <div class="content-body">
                {{ .Content }}
            </div>

            <!-- Wikidata Image Gallery -->
            {{ partial "wikimedia-gallery.html" . }}

            <!-- Reviews Section -->
            {{ partial "reviews.html" . }}

            <div
                style="background: #fff8e1; color: #795548; padding: 25px; border-radius: 8px; margin-top: 50px; border-left: 5px solid var(--accent);">
                <h4 style="margin-bottom: 10px; color: #5d4037;">‚ö†Ô∏è Ziyaret√ßi Notu</h4>
                <p style="margin-bottom: 0;">Giri≈ü √ºcretleri ve ziyaret saatleri deƒüi≈üebilir. Ziyaret etmeden √∂nce
                    l√ºtfen resm√Æ kaynaklardan (M√ºze M√ºd√ºrl√ºƒü√º, Bakanlƒ±k vb.) g√ºncel bilgileri kontrol ediniz.</p>
            </div>

            <div
                style="margin-top: 50px; padding-top: 30px; border-top: 1px solid var(--border); font-size: 0.9rem; color: var(--text-light);">
                <p><strong>Veri Kaynaƒüƒ±:</strong> Bu i√ßerik Wikidata ve Wikipedia verileri kullanƒ±larak derlenmi≈ütir.
                </p>
                {{ if .Params.image }}
                <p><strong>G√∂rsel Lisansƒ±:</strong> <a href="{{ .Params.image }}" target="_blank"
                        rel="nofollow">Wikimedia Commons</a> (Lisans: CC BY-SA veya Public Domain)</p>
                {{ end }}
            </div>
        </article>

        <!-- Desktop Sidebar -->
        <aside class="sidebar-desktop">
            <div
                style="background: white; padding: 30px; border-radius: var(--radius); box-shadow: var(--shadow-sm); border: 1px solid var(--border); position: sticky; top: 120px;">
                <h3
                    style="font-size: 1.2rem; border-bottom: 2px solid var(--accent); padding-bottom: 15px; margin-bottom: 25px; color: var(--primary);">
                    Hƒ±zlƒ± Bilgiler</h3>

                <div style="margin-bottom: 20px;">
                    <span
                        style="display: block; font-size: 0.85rem; color: var(--text-light); margin-bottom: 5px; text-transform: uppercase;">Konum</span>
                    <span style="font-size: 1.1rem; font-weight: 600; color: var(--primary);">{{ .Params.district }}, {{
                        .Params.province }}</span>
                </div>

                <div style="margin-bottom: 25px;">
                    <span
                        style="display: block; font-size: 0.85rem; color: var(--text-light); margin-bottom: 5px; text-transform: uppercase;">T√ºr</span>
                    <a href="/turler/{{ .Params.type | urlize }}"
                        style="color: var(--secondary); font-weight: 600; font-size: 1.1rem; text-decoration: underline;">{{
                        .Params.type }}</a>
                </div>

                {{ if $showMap }}
                <a href="{{ $mapLink }}" target="_blank" class="btn btn-primary"
                    style="display: flex; width: 100%; justify-content: center; gap: 8px;">
                    <span>üó∫Ô∏è</span> Haritada G√∂ster
                </a>
                {{ end }}

                <!-- Social Share -->
                <div style="margin-top: 25px; border-top: 1px solid var(--border); padding-top: 20px;">
                    <span
                        style="display: block; font-size: 0.85rem; color: var(--text-light); margin-bottom: 10px;">PAYLA≈û</span>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="shareTwitter()" class="btn-icon"
                            style="background:#000; color:white; border:none; width:40px; height:40px; border-radius:8px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:1.2rem;"
                            title="X (Twitter)'da Payla≈ü">ùïè</button>
                        <button onclick="shareFacebook()" class="btn-icon"
                            style="background:#1877f2; color:white; border:none; width:40px; height:40px; border-radius:8px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:1.2rem;"
                            title="Facebook'ta Payla≈ü">f</button>
                        <button onclick="shareCopy()" class="btn-icon"
                            style="background:#ddd; color:#333; border:none; width:40px; height:40px; border-radius:8px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:1.2rem;"
                            title="Linki Kopyala">üîó</button>
                    </div>
                </div>
            </div>

            <script>
                function shareTwitter() {
                    const url = encodeURIComponent('{{ .Permalink }}');
                    const text = encodeURIComponent('{{ .Title }}');
                    window.open(`https://twitter.com/intent/tweet?text=${text}&url=${url}`, '_blank');
                }
                function shareFacebook() {
                    const url = encodeURIComponent('{{ .Permalink }}');
                    window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
                }
                function shareCopy() {
                    navigator.clipboard.writeText('{{ .Permalink }}').then(() => {
                        alert('Link kopyalandƒ±!');
                    });
                }
            </script>
    </div>
    </aside>
</div>

<!-- Advanced Internal Linking Strategy -->
<div style="margin-top: 80px;">

    <!-- 1. Yakƒ±ndaki Diƒüer Yapƒ±lar (Same District/City) -->
    <div style="margin-bottom: 50px;">
        <h3
            style="font-size: 1.5rem; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px;">
            üó∫Ô∏è {{ .Params.district | default .Params.province }} Yakƒ±nƒ±ndaki Diƒüer Yapƒ±lar
        </h3>
        <div class="card-grid">
            {{ $nearby := where .Site.RegularPages "Params.district" .Params.district }}
            {{ $nearby = where $nearby "Permalink" "ne" .Permalink }}
            {{ range first 4 $nearby }}
            <article class="card">
                <a href="{{ .RelPermalink }}" class="card-img-wrap">
                    {{ if .Params.featured_image }}
                    <img src="{{ .Params.featured_image }}" alt="{{ .Title }}" class="card-img" loading="lazy">
                    {{ else }}
                    <div style="width: 100%; height: 100%; background: #eee;"></div>
                    {{ end }}
                </a>
                <div class="card-content" style="padding: 15px;">
                    <h4 class="card-title" style="font-size: 1rem; margin: 0;"><a href="{{ .RelPermalink }}">{{
                            .Title }}</a></h4>
                    <span style="font-size: 0.8rem; color: var(--text-light);">{{ .Params.type }}</span>
                </div>
            </article>
            {{ end }}
        </div>
    </div>

    <!-- 2. Aynƒ± Kategorideki Yapƒ±lar -->
    <div style="margin-bottom: 50px;">
        <h3
            style="font-size: 1.5rem; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px;">
            üèõÔ∏è Diƒüer {{ .Params.type }} √ñrnekleri
        </h3>
        <ul
            style="list-style: none; padding: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
            {{ $sameType := where .Site.RegularPages "Params.type" .Params.type }}
            {{ $sameType = where $sameType "Permalink" "ne" .Permalink }}
            {{ range first 6 $sameType }}
            <li>
                <a href="{{ .RelPermalink }}"
                    style="display: flex; align-items: center; gap: 10px; padding: 10px; background: white; border: 1px solid var(--border); border-radius: 8px; transition: transform 0.2s;">
                    <span style="font-size: 1.2rem;">üîπ</span>
                    <div>
                        <span style="display: block; font-weight: 600; color: var(--primary);">{{ .Title }}</span>
                        <span style="font-size: 0.8rem; color: var(--text-light);">{{ .Params.province }}</span>
                    </div>
                </a>
            </li>
            {{ end }}
        </ul>
    </div>

    <!-- 3. ≈ûehir Rehberi -->
    <div style="background: #f8f9fa; padding: 30px; border-radius: 12px; text-align: center;">
        <h3 style="margin-bottom: 15px;">üìç {{ .Params.province }} Gezi Rehberi</h3>
        <p style="margin-bottom: 20px; color: var(--text-light);">{{ .Params.province }} ilindeki diƒüer tarihi ve
            k√ºlt√ºrel miraslarƒ± ke≈üfedin.</p>
        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
            <a href="/iller/{{ .Params.province | urlize }}" class="btn btn-primary">T√ºm {{ .Params.province }}
                Eserleri</a>
            <a href="/turler/cami" class="btn btn-outline"
                style="background:white; color:var(--primary); border:1px solid var(--primary);">Camiler</a>
            <a href="/turler/muze" class="btn btn-outline"
                style="background:white; color:var(--primary); border:1px solid var(--primary);">M√ºzeler</a>
            <a href="/turler/antik-kent" class="btn btn-outline"
                style="background:white; color:var(--primary); border:1px solid var(--primary);">Antik Kentler</a>
        </div>
    </div>

</div>
</div>
{{ end }}